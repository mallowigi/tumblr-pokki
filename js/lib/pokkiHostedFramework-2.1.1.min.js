if("undefined"!=typeof pokki)var pokkiHosted=function(){console.log("[Pokki Hosted Apps Framework] v2.1.1");var e={},r=function(){function e(){var e=document.querySelectorAll('script[src*="pokkiHostedFramework"]')[0];return e&&"undefined"!=typeof e.dataset.debug?!0:r.debug&&"true"===r.debug?!0:!1}var r={};return r.debug=localStorage.getItem("debug"),r.log=function(){if(e()){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);r.unshift("[HOSTED DEBUG]"),console.log.apply(console,r)}},r.error=function(){for(var e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);e.unshift("[HOSTED ERROR]"),console.error.apply(console,e)},r.loadAsyncFile=function(e,t,o){r.log("loadAsyncFile("+e+")");var n=new XMLHttpRequest;n.onload=function(){t&&t(n)},n.onerror=function(e){o?o(e):r.error(n.statusText)},n.open("get",e,!0),n.send()},r.convertToRegEx=function(e){return e=e.replace(/(\.|\/)/g,"\\$1"),e=e.replace(/(\*|\+)/g,".$1")},r.arrayUnique=function(e){for(var r=e.concat(),t=0;t<r.length;++t)for(var o=t+1;o<r.length;++o)r[t]===r[o]&&r.splice(o--,1);return r},r.escape=function(e,r){switch(r){case"regex":return e=e.replace(/([\?])/g,"\\$1"),e.replace(/([\*\+])/g,".$1");case"inject":var t=(e+"").replace(/\\/g,"\\\\");return t.replace(/([\"\'])/g,"\\$1").replace(/[\r\n]+/g,"\\n").replace(/[\t]+/g," ");default:var t=e.replace(/[\*\@\-\_\+\.\/]/g,"$1");return escape(e)}},r},t=new r;return e.Application=function(e){function r(e){j=e,t.loadAsyncFile(e,o,n)}function o(e){E.injections[j]=t.escape(e.responseText,"inject"),P.length>0?r(P.shift()):(t.log("Finished parsing files for injections: ",E.injections),x=!0,i())}function n(e){console.log("fileError",e)}function i(){b&&x&&"start"===y&&pokki.navigateTo(E.options.urls.start,k)}function a(){function e(e){-1==t.indexOf(e)&&t.push(e)}function r(t){if("string"==typeof t)e(t);else if("object"==typeof t)if(t.length)for(var o=0;o<t.length;o++)e(t[o]);else for(var n in t)r(t[n])}var t=[];for(key in E.options.injections){var o=E.options.injections[key];r(o)}return t}function s(e){if(E.options.urls.redirects){for(key in E.options.urls.redirects){var r=new RegExp(t.escape(key,"regex"));if(e.match(r))return t.log("redirecting: "+e+" => "+E.options.urls.redirects[key]),E.options.urls.redirects[key]}return e}return e}function l(e){return E.options.urls.whitelist?"start"===e||e===E.options.urls.start?!0:u(e,E.options.urls.whitelist):!0}function c(e){return E.options.urls.websheet?u(e,E.options.urls.websheet):!1}function p(e){return E.options.urls.blacklist?u(e,E.options.urls.blacklist):!1}function u(e,r){for(var o=0;o<r.length;o++){var n=r[o],i=new RegExp(t.convertToRegEx(n));if(e.match(i))return!0}return!1}function g(e,r){var o={before:"",after:""};if("error"==r)return'var pokkiHosted = {error:{msg:"'+w.msg+'",code:"'+w.code+'"}}';if(E.options.injections){var n=[],i=[];for(key in E.options.injections){var a=new RegExp(t.escape(key,"regex"));if(e.match(a)){var s=E.options.injections[key];"object"!=typeof s||s.length?n=t.arrayUnique(n.concat(d(s))):(s.before&&(n=t.arrayUnique(n.concat(d(s.before)))),s.after&&(i=t.arrayUnique(i.concat(d(s.after)))))}}n.length>0&&(o.before=f(n)),i.length>0&&(o.after=f(i))}return o}function d(e){var r=[];if("string"==typeof e)r.push(e);else if("object"==typeof e&&e.length)for(var t=0;t<e.length;t++){var o=e[t];-1==r.indexOf(o)&&r.push(o)}return r}function f(e){function r(e){return"var style = document.head.appendChild( document.createElement('style') );style.className += 'override';style.appendChild(document.createTextNode('"+e+"'));"}function o(e){return"var script = document.head.appendChild( document.createElement('script') );script.className += 'override';script.appendChild(document.createTextNode('"+e+"'));"}t.log("Files to inject:",e);for(var n="",i=0;i<e.length;i++){var a=e[i],s=E.injections[a];if(s){var l=a.split(".").pop();switch(l){case"css":n+=r(s);break;case"js":n+=o(s);break;default:t.log("[ERROR] file extenstion'"+l+"' not available for injection")}}}var c="if(document.head){"+n+"}else{"+"var checkInt = setInterval(function(){"+"if(document.head){"+n+"clearInterval(checkInt);"+"}"+"},1);"+"}";return c}function m(){function e(e,r){e===k&&pokki.rpc("splash",'pokki.eventBroadcast("windowProgress",'+r+")")}pokki.loadPage(k,E.options.splashPage,"splash"),pokki.setPageVisible("splash",!0),pokki.addEventListener("onPageLoadProgress",e)}function h(e){pokki.eventBroadcast("outboundLink",e),pokki.openURLInDefaultBrowser(e.url)}function v(e){if(t.log("Page '"+e.pageName+"' Loading - ",e),E.options.override){var r=E.options.override(e);if(r){if("string"!=typeof r)return t.log("Override! returning object:",r),r;t.log("Override! setting url to ",r),e.url=r}}if(e.url=s(e.url),"splash"!=e.pageName&&"error"!=e.pageName){if(p(e.url))return t.log("Url in blacklist, opening in default browser."),h(e),{targetUrl:""};if(e.pageName.match(/websheet/)){if(!c(e.url))return l(e.url)?(t.log("Page is trying to open an approved domain in the websheet"),pokki.navigateTo(e.url,k)):(t.log("Not approved for websheet, open in default browser"),h(e)),{targetUrl:""}}else if(c(e.url)){if(e.action.match(/open/))return t.log("Forcing window open"),pokki.rpc(e.pageName,'window.open("'+e.url+'")'),{targetUrl:""}}else{if(!l(e.url))return t.log("url not approved, opening in default browser."),h(e),{targetUrl:""};k=e.pageName,y=e.url}"start"===e.url&&(b&&x&&(y=e.url=E.options.urls.start),E.options.splashPage&&m())}var o=g(e.url,e.pageName);return{targetUrl:e.url,targetPage:e.pageName,injectBeforeDOM:o.before,injectAfterDOM:o.after}}t.log("Hosted Application Created");var b=!1,k="",y="",w={},x=!1,E={};if("string"==typeof e)E.options={urls:{start:e}};else if("object"==typeof e){if(!e.urls.start)return t.error("property 'url' required!");E.options=e}if(E.options.injections){E.injections={};var j,P=a();r(P.shift())}else x=!0;return E.showError=function(e,r,o){function n(e,r,t){var o=".errorOverlay {color: #212121;background-color: #FFF;position: absolute;text-align: center;top: 0;left: 0;width: 100%;height: 100%;}.messageContainer {height: 160px;width: 100%;position: absolute;top: 50%;margin-top: -80px;-webkit-user-select: none;}.errorOverlay p {margin: 0;padding-bottom: 15px;}.exclamation {padding-top: 15%;}.note {margin-top: 20%;font-size: 22px;font-weight: bold;}.message {font-size: 16px;color: #85879c;}.button {background: -webkit-linear-gradient(top, #ffffff 0%,#f0f1f6 100%);border: 1px solid #c0c1d4;border-radius: 2px;color: #333;display: inline-block;font-weight: bold;cursor: pointer;text-decoration: none;line-height: 36px;height: 36px;width: 125px;margin: 15px 0;padding: 0px;-webkit-box-shadow: 0px 1px 1px 1px rgba(233, 229, 229, 1);}.button:hover {border: 1px solid #a2a3b3;}.button:active {color: #333;background: #eeeff4;-webkit-box-shadow: inset 0px 0px 3px 1px rgba(0, 0, 0, .3);}",n="var style = document.createElement('style');style.appendChild(document.createTextNode('"+o+"'));"+"var errorOverlay = document.createElement('div');"+"errorOverlay.className = 'errorOverlay';"+"var messageContainer = document.createElement('div');"+"messageContainer.className = 'messageContainer';"+"errorOverlay.appendChild(messageContainer);"+"var note = document.createElement('p');"+"note.className = 'note';"+"note.innerHTML = '"+e+"';"+"messageContainer.appendChild(note);"+"var message = document.createElement('p');"+"message.className = 'message';"+"message.innerHTML = '"+r+"';"+"messageContainer.appendChild(message);"+"var retry = document.createElement('a');"+"retry.className = 'button';"+"retry.onclick = function(){"+"console.log('attempting retry');"+"pokki.navigateTo('"+t+"',window.name);"+"};"+"retry.innerHTML = 'Retry';"+"messageContainer.appendChild(retry);"+"document.body.appendChild(errorOverlay);"+"document.getElementsByTagName('head')[0].appendChild(style);";return n}t.log("showing error - message: ",e,o),e=e||"",r=r||"",o=o||"",w={message:e,description:r,message:o},E.options.errorPage?(pokki.loadPage(k,E.options.errorPage,"error"),pokki.setPageVisible("error",!0)):setTimeout(function(){pokki.rpc(k,n(e,r,y))},1)},E.start=function(){t.log("Hosted Application Started - options: ",E.options),b=!0,i()},E.setUrlOverride=function(e){E.options.override=e},E.__defineGetter__("onPageLoading",function(){return E.options.override}),E.__defineSetter__("onPageLoading",function(e){E.options.override=e}),window.onPageLoading=function(e,r,t,o){var n={url:e,pageName:r,currentUrl:t,action:o};return pokki.eventBroadcast("onPageLoading",n),v(n)},window.onPageLoadingError=function(e,r,o){t.error("Page Loading Error - ",r,e+" : "+o),-100>=o&&o>=-199&&r===k&&(window.navigator.onLine?E.showError("There is a temporary problem with this app.","Please try again later.",o):E.showError("You are not connected to the internet.","Please check your connection and retry.",o))},E},e.importFile=function(e,r){var o=e.split(".").pop(),n="";switch(o){case"css":n="style";break;case"js":n="script";break;default:return t.error("File type for '"+o+"' not supported"),t.log("Supported file types: .js, .css"),void 0}t.loadAsyncFile.call(arguments)},e.debug=function(){t.debug=localStorage.getItem("debug"),t.debug&&"true"===t.debug?(t.debug=null,localStorage.setItem("debug",""),console.log("[HOSTED DEBUG] Debug disabled.")):(t.debug="true",localStorage.setItem("debug",!0),console.log("[HOSTED DEBUG] Debug enabled."))},e}();else console.error("Pokki not available! Are you on the Pokki platform?");